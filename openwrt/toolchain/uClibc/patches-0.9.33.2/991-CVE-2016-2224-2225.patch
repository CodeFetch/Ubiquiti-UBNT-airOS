--- a/libc/inet/resolv.c	2016-04-08 16:03:12.220454641 +0300
+++ b/libc/inet/resolv.c	2016-04-08 16:01:35.424056350 +0300
@@ -668,11 +668,13 @@
 	bool measure = 1;
 	unsigned total = 0;
 	unsigned used = 0;
+	unsigned maxiter = 256;
 
 	if (!packet)
 		return -1;
 
+	dest[0] = '\0';
+	while (--maxiter) {
-	while (1) {
 		if (offset >= packet_len)
 			return -1;
 		b = packet[offset++];
@@ -709,6 +707,9 @@
 		else
 			dest[used++] = '\0';
 	}
+	if (!maxiter)
+		return -1;
+
 
 	/* The null byte must be counted too */
