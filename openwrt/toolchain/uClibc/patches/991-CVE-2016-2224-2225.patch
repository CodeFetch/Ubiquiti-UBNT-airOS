--- a/libc/inet/resolv.c	2016-04-11 16:42:33.696647210 +0300
+++ b/libc/inet/resolv.c	2016-04-11 16:44:17.092320607 +0300
@@ -417,11 +417,13 @@
 	bool measure = 1;
 	unsigned total = 0;
 	unsigned used = 0;
+	unsigned maxiter = 256;
 
 	if (!data)
 		return -1;
 
-	while ((l=data[offset++])) {
+	dest[0] = '\0';
+	while ((l=data[offset++]) && --maxiter) {
 		if (measure)
 		    total++;
 		if ((l & 0xc0) == (0xc0)) {
@@ -447,6 +449,8 @@
 		else
 			dest[used++] = '\0';
 	}
+	if (!maxiter)
+		return -1;
 
 	/* The null byte must be counted too */
 	if (measure) {
